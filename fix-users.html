<!DOCTYPE html>
<html dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>×ª×™×§×•×Ÿ ××©×ª××©×™×</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }
        .danger {
            background: #f44336;
        }
        .danger:hover {
            background: #da190b;
        }
        pre {
            background: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
        }
        .success {
            color: green;
            font-weight: bold;
        }
        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”§ ×›×œ×™ ×ª×™×§×•×Ÿ ××©×ª××©×™×</h1>
        <div id="output"></div>

        <button onclick="checkUsers()">×‘×“×•×§ ××©×ª××©×™× ×§×™×™××™×</button>
        <button onclick="approveAllUsers()">××©×¨ ××ª ×›×œ ×”××©×ª××©×™×</button>
        <button onclick="clearAllData()" class="danger">× ×§×” ××ª ×›×œ ×”× ×ª×•× ×™×</button>
    </div>

    <script>
        const prefix = 'busManager_';

        function output(msg, type = '') {
            const div = document.getElementById('output');
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : '';
            div.innerHTML += `<p class="${className}">${msg}</p>`;
        }

        function clearOutput() {
            document.getElementById('output').innerHTML = '';
        }

        function checkUsers() {
            clearOutput();
            const usersData = localStorage.getItem(prefix + 'users');

            if (!usersData) {
                output('âŒ ×œ× × ××¦××• ××©×ª××©×™× ×‘-localStorage', 'error');
                output('×–×” ××•××¨ ×©××ª×” ××©×ª××© ×‘××¦×‘ Firebase ××• ×©×¢×“×™×™×Ÿ ×œ× × ×¨×©××ª');
                return;
            }

            try {
                const users = JSON.parse(usersData);
                output(`âœ… × ××¦××• ${users.length} ××©×ª××©×™×:`, 'success');
                output('<pre>' + JSON.stringify(users, null, 2) + '</pre>');

                const unapproved = users.filter(u => !u.approved);
                if (unapproved.length > 0) {
                    output(`âš ï¸ ${unapproved.length} ××©×ª××©×™× ×××ª×™× ×™× ×œ××™×©×•×¨`, 'error');
                }
            } catch (e) {
                output('âŒ ×©×’×™××” ×‘×§×¨×™××ª × ×ª×•× ×™ ××©×ª××©×™×: ' + e.message, 'error');
            }
        }

        function approveAllUsers() {
            clearOutput();
            const usersData = localStorage.getItem(prefix + 'users');

            if (!usersData) {
                output('âŒ ×œ× × ××¦××• ××©×ª××©×™×', 'error');
                return;
            }

            try {
                const users = JSON.parse(usersData);

                // Approve all users and make first one admin
                users.forEach((user, index) => {
                    user.approved = true;
                    if (index === 0 && user.role !== 'admin') {
                        user.role = 'admin';
                    }
                });

                localStorage.setItem(prefix + 'users', JSON.stringify(users));

                output('âœ… ×›×œ ×”××©×ª××©×™× ××•×©×¨×• ×‘×”×¦×œ×—×”!', 'success');
                output(`âœ… ${users[0].email} ×”×•×’×“×¨ ×›×× ×”×œ`, 'success');
                output('ğŸ’¡ ×›×¢×ª ×ª×•×›×œ ×œ×”×ª×—×‘×¨ ×œ××¢×¨×›×ª');

                setTimeout(() => {
                    window.location.href = 'index.html';
                }, 2000);
            } catch (e) {
                output('âŒ ×©×’×™××”: ' + e.message, 'error');
            }
        }

        function clearAllData() {
            if (!confirm('×”×× ××ª×” ×‘×˜×•×—? ×–×” ×™××—×§ ××ª ×›×œ ×”× ×ª×•× ×™× (××©×ª××©×™×, ×ª×œ××™×“×™×, ××•×˜×•×‘×•×¡×™×)')) {
                return;
            }

            clearOutput();

            const keys = Object.keys(localStorage).filter(k => k.startsWith(prefix));
            keys.forEach(key => localStorage.removeItem(key));

            output('âœ… ×›×œ ×”× ×ª×•× ×™× × ×•×§×•', 'success');
            output('ğŸ’¡ ×›×¢×ª ×ª×•×›×œ ×œ×”×™×¨×©× ××—×“×© ×›××©×ª××© ×¨××©×•×Ÿ (×× ×”×œ)');

            setTimeout(() => {
                window.location.href = 'index.html';
            }, 2000);
        }

        // Auto-check on load
        window.addEventListener('load', checkUsers);
    </script>
</body>
</html>
